# ViDARs(VisualisedDetectionAndRanging system)

## OverAll

ステージ上に表示される主人公を中心に、一定範囲のメッシュを探知し、レーダー画面(Polar Graph)に表示する

## DetectionAndRanging

### 方針

- 兵装制御システムにとってのセンサー : ゲームシステム

- プレイヤーにとっての戦況把握 : プレイヤー

- 視覚トリックのようなゲームアイデアと雰囲気作り : コンテンツ

上記3つの性質をあわせもつこと

コリジョンメッシュに対するプレイヤー視点からのレイキャスティングで実装される

- 拡張性を踏まえ一部処理は3Dで実装しているが、コリジョンメッシュは2Dで実装する

照射されるレイの種類、メッシュの各種Attrubute、速度、回転、角度、距離に応じた反射波の変化

- 但し「反射波」というものは厳密にいうと存在しない
- レイキャストを行った際に上記のパラメータから受信強度が決定される
- あくまで1段階のレイキャスティングであり、反射などを扱うレイトレーシングではない

### 実装

ポリゴン分解

- 全オブジェクトのメッシュをポリゴンに分解(これはオブジェクト生成時に予め行う)

走査面(線)生成

- 走査頂点をプレイヤーオブジェクトの中心点から同一半径で一定間隔毎に展開
- 隣り合う頂点から走査グリッドを生成
- この時に各走査点に走査角$\theta$を割り当てるとともに、$cos(\theta), sin(\theta)$の値も割り当てる
- 後述の投影処理では$cos, sin$の単調性を活かし、対象がどのグリッドに属するかを、内積でcosを、外積のノルムでsinを出して数値的にサーチして求める

**以下は全て"2D"で"各フレーム毎"に行う!!!**

投影(幾何学的情報のみ)

- 各オブジェクトのポリゴンをローカル座標、更にカメラ座標へ変換
- この際に中心点から各頂点へのベクトルを算出
- 距離とキャラクターオブジェクトとの内積・外積から頂点が走査範囲内か確認
- 全ての頂点が一定範囲外ならその時点で処理を終了
- 範囲内の頂点については上述の通りポリゴン頂点の探知位置ピクセルを決定
- ポリゴン走査終了時点で線形補間を実行、頂点に囲まれた範囲を距離を与えて埋める
- この時点では他のメッシュに隠れるはずの対象もR-bufferに蓄えられていることに注意

カリング＆ラスタライズ(幾何学的情報のみ)

- カメラ座標変換後の距離を基に、R-bufferに蓄えられた対象から探知対象を1つに絞る
- この段階で、線形補間によって探知範囲外の対象をピクセルに蓄えていた場合は消去

ピクセルシェーダ(各種Attributeを使う)

- 本来は主に色付けや透明度情報の反映が行われる
- ViDARSでは「反射強度」が角度、表面ラフネス、反射スペクトルから定まる
- 更に、速度情報からドップラー方式により運動情報も各ピクセルに加わる

## Visualiser

距離を基に角ピクセル毎にどの位置に表示するかを選択

速度情報から色分けも可能になる
